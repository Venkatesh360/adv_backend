# Overview of Alembic and Migration Best Practices

---

## What is Alembic?

Alembic is a lightweight database migration tool designed to work with SQLAlchemy. It helps manage and version-control database schema changes by creating migration scripts that define how to upgrade or downgrade your database schema incrementally.

Alembic enables:

- Schema versioning and tracking
- Applying incremental migrations
- Rolling back changes safely
- Autogenerating migrations based on model changes
- Integration with Python projects using SQLAlchemy

---

## Core Concepts

- **Migration Script**: Python files with `upgrade()` and `downgrade()` functions describing schema changes.
- **Revision**: A unique identifier for each migration.
- **Head**: The latest migration revision.
- **Autogenerate**: Feature to detect schema differences and create migration scripts automatically.
- **Versions Directory**: Stores all migration scripts.

---

## Migration Best Practices

### 1. Keep Migrations Small and Focused

Each migration should do one logical change. Avoid large, monolithic migrations.

### 2. Use Descriptive Messages

Write clear revision messages with `-m` flag, e.g., `"Add user email column"`.

### 3. Review Autogenerated Scripts

Autogeneration is a convenience, not a replacement for review. Check for errors or missing operations.

### 4. Separate Schema and Data Migrations

Use Alembic for schema changes only. Use separate seed scripts or data migration strategies for populating or transforming data.

### 5. Test Migrations Locally

Apply and rollback migrations in a local/dev environment before production deployment.

### 6. Use Version Control

Commit migration scripts to source control to maintain history and enable team collaboration.

### 7. Handle Downgrades Carefully

Implement `downgrade()` functions to support safe rollbacks but avoid destructive operations that are hard to reverse.

### 8. Manage Database URLs Securely

Use environment variables or config files for connection strings, not hardcoded credentials.

### 9. Automate Migrations in CI/CD

Integrate migration application in your deployment pipelines for consistent environments.

---

## Useful Commands

```bash
# Initialize Alembic
alembic init alembic

# Generate a new migration (autogenerate)
alembic revision --autogenerate -m "Add new table"

# Apply all migrations
alembic upgrade head

# Rollback last migration
alembic downgrade -1

# Show current revision
alembic current
```
